

result1(Product,Label,Rdfslabel,Rdftype,Producttype,Bsbmproductfeature,Productfeature1,Productfeature2,Bsbmproductpropertynumeric1,Value1,X,Productxyz,Bsbmproductpropertytextual4,Propertytextual4) :- 
	rdf3(Product, 'Rdfslabel', Label),
	rdf3(Product, 'Rdftype', Producttype),
	rdf3(Product, 'Bsbmproductfeature', Productfeature1),
	rdf3(Product, 'Bsbmproductfeature', Productfeature2),
	rdf3(Product, 'Bsbmproductpropertynumeric1', Value1),
	FilterRight0 is X, Value1 > FilterRight0,
	(rdf3(Productxyz, 'Bsbmproductpropertytextual4', Propertytextual4); not rdf3(Productxyz, 'Bsbmproductpropertytextual4', Propertytextual4)).


orderby(UnorderedBag, OrderedBag) :- sortby(UnorderedBag, 2, OrderedBag).


limit(_, Count, Count, Result) :- Result = [].
limit([], _, _, Result) :- Result = [].
limit([H|T], Counter, Limit, Result):-
    Counter < Limit, 
    Counter2 is Counter + 1,
    limit(T, Counter2, Limit, Result2),
    Result = [H|Result2]. 

query(FinalBag):-
	setof(query_intermediate(Product,Label,Rdfslabel,Rdftype,Producttype,Bsbmproductfeature,Productfeature1,Productfeature2,Bsbmproductpropertynumeric1,Value1,X,Productxyz,Bsbmproductpropertytextual4,Propertytextual4), query_intermediate(Product,Label,Rdfslabel,Rdftype,Producttype,Bsbmproductfeature,Productfeature1,Productfeature2,Bsbmproductpropertynumeric1,Value1,X,Productxyz,Bsbmproductpropertytextual4,Propertytextual4), ResultIntermediate),
	orderby(ResultIntermediate, OrderedResult),
	limit(OrderedResult, 0, 10, LimitResult),
	FinalBag = LimitResult.

query_intermediate(Product,Label,Rdfslabel,Rdftype,Producttype,Bsbmproductfeature,Productfeature1,Productfeature2,Bsbmproductpropertynumeric1,Value1,X,Productxyz,Bsbmproductpropertytextual4,Propertytextual4):- result1(Product,Label,Rdfslabel,Rdftype,Producttype,Bsbmproductfeature,Productfeature1,Productfeature2,Bsbmproductpropertynumeric1,Value1,X,Productxyz,Bsbmproductpropertytextual4,Propertytextual4).
