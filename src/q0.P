

result1(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3) :- 
	rdf3('Product', '<http://www.w3.org/2000/01/rdf-schema#label>', 'Label'),
	rdf3('Product', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'Producttype'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature1'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature2'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productPropertyNumeric1>', 'P1'),
	pcre:match("%word1%|%word2%|%word3%", ?label, Matchlist, 'one'), Matchlist \==[],
	FilterRight0 is ?origProperty2+220, ?simProperty2 == FilterRight0,
	FilterRight1 is ?origProperty2-150, ?simProperty2 > FilterRight1,
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productPropertyNumeric1>', 'P1'),
	FilterRight2 is ?product, %ProductXYZ% =\= FilterRight2,
	var(?testVar),
	(rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature2'); not rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature2')),
	(rdf3('Product', '<http://www.w3.org/2000/01/rdf-schema#label>', 'Testvar'); not rdf3('Product', '<http://www.w3.org/2000/01/rdf-schema#label>', 'Testvar')),
	FilterRight3 is ?origProperty1+150, ?simProperty1 < FilterRight3,
	FilterRight4 is ?origProperty1-150, ?simProperty1 > FilterRight4,
	FilterRight5 is %x%, ?value1 > FilterRight5,
	FilterRight6 is ?origProperty2+220, ?simProperty2 < FilterRight6,
	FilterRight7 is ?origProperty2-220, ?simProperty2 > FilterRight7.


result2(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3) :- 
	rdf3('Product', '<http://www.w3.org/2000/01/rdf-schema#label>', 'Label'),
	rdf3('Product', '<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>', 'Producttype'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature1'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productFeature>', 'Productfeature3'),
	rdf3('Product', '<http://www4.wiwiss.fu-berlin.de/bizer/bsbm/v01/vocabulary/productPropertyNumeric2>', 'P2').

orderby(UnorderedBag, OrderedBag) :- sortby(UnorderedBag, 1, OrderedBag).


limit(_, Count, Count, Result) :- Result = [].
limit([], _, _, Result) :- Result = [].
limit([H|T], Counter, Limit, Result):-
    Counter < Limit, 
    Counter2 is Counter + 1,
    limit(T, Counter2, Limit, Result2),
    Result = [H|Result2]. 

query(FinalBag):-
	setof(query_intermediate(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3), query_intermediate(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3), ResultIntermediate),
	orderby(ResultIntermediate, OrderedResult),
	limit(OrderedResult, 0, 10, LimitResult),
	FinalBag = LimitResult.

query_intermediate(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3):- result1(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3); result2(Product,Label,Producttype,Productfeature1,Productfeature2,Productfeature2,Producttype,Productfeature1,Productfeature3).